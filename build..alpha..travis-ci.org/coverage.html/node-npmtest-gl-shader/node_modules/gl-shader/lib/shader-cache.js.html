<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for node-npmtest-gl-shader/node_modules/gl-shader/lib/shader-cache.js</title>
    <meta charset="utf-8">
    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Arial, Helvetica;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            height: 160px;
            padding: 0 1em 0 1em;
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 170px;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Menlo, Monaco, Consolas, Courier New, monospace;
            margin: 0;
            padding: 0;
            font-size: 14px;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { color: #000; }
        div.coverage-summary a:visited { color: #333; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header low">
    <h1 style="font-weight: bold;">
        <a href="https://github.com/npmtest/node-npmtest-gl-shader">npmtest-gl-shader (v0.0.1)</a>
    </h1>
    <h1>Code coverage report for <span class="entity">node-npmtest-gl-shader/node_modules/gl-shader/lib/shader-cache.js</span></h1>
    <h2>
        
        Statements: <span class="metric">21.95% <small>(18 / 82)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">5% <small>(1 / 20)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">0% <small>(0 / 10)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">21.95% <small>(18 / 82)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../../../index.html">All files</a> &#187; <a href="index.html">node-npmtest-gl-shader/node_modules/gl-shader/lib/</a> &#187; shader-cache.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</td><td class="line-coverage"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">'use strict'
&nbsp;
exports.shader   = getShaderReference
exports.program  = createProgram
&nbsp;
var GLError = require("./GLError")
var formatCompilerError = require('gl-format-compiler-error');
&nbsp;
var weakMap = typeof WeakMap === 'undefined' ? <span class="branch-0 cbranch-no" title="branch not covered" >require('weakmap-shim') </span>: WeakMap
var CACHE = new weakMap()
&nbsp;
var SHADER_COUNTER = 0
&nbsp;
<span class="fstat-no" title="function not covered" >function ShaderReference(id, src, type, shader, programs, count, cache) {</span>
<span class="cstat-no" title="statement not covered" >  this.id       = id</span>
<span class="cstat-no" title="statement not covered" >  this.src      = src</span>
<span class="cstat-no" title="statement not covered" >  this.type     = type</span>
<span class="cstat-no" title="statement not covered" >  this.shader   = shader</span>
<span class="cstat-no" title="statement not covered" >  this.count    = count</span>
<span class="cstat-no" title="statement not covered" >  this.programs = []</span>
<span class="cstat-no" title="statement not covered" >  this.cache    = cache</span>
}
&nbsp;
ShaderReference.prototype.dispose = <span class="fstat-no" title="function not covered" >function() {</span>
<span class="cstat-no" title="statement not covered" >  if(--this.count === 0) {</span>
<span class="cstat-no" title="statement not covered" >    var cache    = this.cache</span>
<span class="cstat-no" title="statement not covered" >    var gl       = cache.gl</span>
&nbsp;
    //Remove program references
<span class="cstat-no" title="statement not covered" >    var programs = this.programs</span>
<span class="cstat-no" title="statement not covered" >    for(var i=0, n=programs.length; i&lt;n; ++i) {</span>
<span class="cstat-no" title="statement not covered" >      var p = cache.programs[programs[i]]</span>
<span class="cstat-no" title="statement not covered" >      if(p) {</span>
<span class="cstat-no" title="statement not covered" >        delete cache.programs[i]</span>
<span class="cstat-no" title="statement not covered" >        gl.deleteProgram(p)</span>
      }
    }
&nbsp;
    //Remove shader reference
<span class="cstat-no" title="statement not covered" >    gl.deleteShader(this.shader)</span>
<span class="cstat-no" title="statement not covered" >    delete cache.shaders[(this.type === gl.FRAGMENT_SHADER)|0][this.src]</span>
  }
}
&nbsp;
<span class="fstat-no" title="function not covered" >function ContextCache(gl) {</span>
<span class="cstat-no" title="statement not covered" >  this.gl       = gl</span>
<span class="cstat-no" title="statement not covered" >  this.shaders  = [{}, {}]</span>
<span class="cstat-no" title="statement not covered" >  this.programs = {}</span>
}
&nbsp;
var proto = ContextCache.prototype
&nbsp;
<span class="fstat-no" title="function not covered" >function compileShader(gl, type, src) {</span>
<span class="cstat-no" title="statement not covered" >  var shader = gl.createShader(type)</span>
<span class="cstat-no" title="statement not covered" >  gl.shaderSource(shader, src)</span>
<span class="cstat-no" title="statement not covered" >  gl.compileShader(shader)</span>
<span class="cstat-no" title="statement not covered" >  if(!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {</span>
<span class="cstat-no" title="statement not covered" >    var errLog = gl.getShaderInfoLog(shader)</span>
<span class="cstat-no" title="statement not covered" >    try {</span>
<span class="cstat-no" title="statement not covered" >        var fmt = formatCompilerError(errLog, src, type);</span>
    } catch (e){
<span class="cstat-no" title="statement not covered" >        console.warn('Failed to format compiler error: ' + e);</span>
<span class="cstat-no" title="statement not covered" >        throw new GLError(errLog, 'Error compiling shader:\n' + errLog)</span>
    }
<span class="cstat-no" title="statement not covered" >    throw new GLError(errLog, fmt.short, fmt.long)</span>
  }
<span class="cstat-no" title="statement not covered" >  return shader</span>
}
&nbsp;
proto.getShaderReference = <span class="fstat-no" title="function not covered" >function(type, src) {</span>
<span class="cstat-no" title="statement not covered" >  var gl      = this.gl</span>
<span class="cstat-no" title="statement not covered" >  var shaders = this.shaders[(type === gl.FRAGMENT_SHADER)|0]</span>
<span class="cstat-no" title="statement not covered" >  var shader  = shaders[src]</span>
<span class="cstat-no" title="statement not covered" >  if(!shader || !gl.isShader(shader.shader)) {</span>
<span class="cstat-no" title="statement not covered" >    var shaderObj = compileShader(gl, type, src)</span>
<span class="cstat-no" title="statement not covered" >    shader = shaders[src] = new ShaderReference(</span>
      SHADER_COUNTER++,
      src,
      type,
      shaderObj,
      [],
      1,
      this)
  } else {
<span class="cstat-no" title="statement not covered" >    shader.count += 1</span>
  }
<span class="cstat-no" title="statement not covered" >  return shader</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function linkProgram(gl, vshader, fshader, attribs, locations) {</span>
<span class="cstat-no" title="statement not covered" >  var program = gl.createProgram()</span>
<span class="cstat-no" title="statement not covered" >  gl.attachShader(program, vshader)</span>
<span class="cstat-no" title="statement not covered" >  gl.attachShader(program, fshader)</span>
<span class="cstat-no" title="statement not covered" >  for(var i=0; i&lt;attribs.length; ++i) {</span>
<span class="cstat-no" title="statement not covered" >    gl.bindAttribLocation(program, locations[i], attribs[i])</span>
  }
<span class="cstat-no" title="statement not covered" >  gl.linkProgram(program)</span>
<span class="cstat-no" title="statement not covered" >  if(!gl.getProgramParameter(program, gl.LINK_STATUS)) {</span>
<span class="cstat-no" title="statement not covered" >    var errLog = gl.getProgramInfoLog(program)</span>
<span class="cstat-no" title="statement not covered" >    throw new GLError(errLog, 'Error linking program: ' + errLog)</span>
  }
<span class="cstat-no" title="statement not covered" >  return program</span>
}
&nbsp;
proto.getProgram = <span class="fstat-no" title="function not covered" >function(vref, fref, attribs, locations) {</span>
<span class="cstat-no" title="statement not covered" >  var token = [vref.id, fref.id, attribs.join(':'), locations.join(':')].join('@')</span>
<span class="cstat-no" title="statement not covered" >  var prog  = this.programs[token]</span>
<span class="cstat-no" title="statement not covered" >  if(!prog || !this.gl.isProgram(prog)) {</span>
<span class="cstat-no" title="statement not covered" >    this.programs[token] = prog = linkProgram(</span>
      this.gl,
      vref.shader,
      fref.shader,
      attribs,
      locations)
<span class="cstat-no" title="statement not covered" >    vref.programs.push(token)</span>
<span class="cstat-no" title="statement not covered" >    fref.programs.push(token)</span>
  }
<span class="cstat-no" title="statement not covered" >  return prog</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function getCache(gl) {</span>
<span class="cstat-no" title="statement not covered" >  var ctxCache = CACHE.get(gl)</span>
<span class="cstat-no" title="statement not covered" >  if(!ctxCache) {</span>
<span class="cstat-no" title="statement not covered" >    ctxCache = new ContextCache(gl)</span>
<span class="cstat-no" title="statement not covered" >    CACHE.set(gl, ctxCache)</span>
  }
<span class="cstat-no" title="statement not covered" >  return ctxCache</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function getShaderReference(gl, type, src) {</span>
<span class="cstat-no" title="statement not covered" >  return getCache(gl).getShaderReference(type, src)</span>
}
&nbsp;
<span class="fstat-no" title="function not covered" >function createProgram(gl, vref, fref, attribs, locations) {</span>
<span class="cstat-no" title="statement not covered" >  return getCache(gl).getProgram(vref, fref, attribs, locations)</span>
}
&nbsp;
&nbsp;</pre></td></tr>
</table></pre>
</div>
<div class="footer">
    <div class="meta">Generated by <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a> at Fri Apr 21 2017 18:20:48 GMT+0000 (UTC)</div>
</div>
</body>
</html>
